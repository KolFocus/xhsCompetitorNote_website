# 创建报告功能设计文档

## 1. 功能概述

报告是一个笔记集合，作为分析的基础数据源。报告 = 笔记集合 + 基于这个集合的分析结果。

用户可以通过筛选条件（竞品、时间范围等）快速选择一批笔记，批量导入到报告中。报告创建后，如果竞品有新增笔记，用户可以手动追加导入。用户可以对报告中的笔记进行管理（忽略、删除、恢复），以确保分析数据的准确性。

该功能旨在帮助用户进行竞品分析、趋势分析、数据对比等数据挖掘工作。

## 2. 核心功能

### 2.1 创建报告

用户通过筛选条件（品牌、时间范围等）选择一批笔记，批量导入到新报告中。

- **对话框字段顺序**（从上到下）：报告名称（必填，8-20字）、品牌选择（多选，至少选1个）、时间范围（可选）
- **品牌选择**：支持多选品牌，至少需要选择1个品牌
- **时间范围选择**：选择开始日期和结束日期，可选
- **动态计算**：当品牌或时间范围变化时，系统自动计算符合条件的笔记总数，计算过程中按钮禁用，计算完成后显示笔记数量并恢复按钮可用
- **笔记数量显示**：在筛选条件下方另起一行显示，格式为"共找到 X 条笔记"
- **按钮可用条件**：报告名称已填写（8-20字）且至少选择1个品牌，且计算完成，且至少有一条有效笔记
- **批量导入**：将符合条件的笔记导入到新报告中

### 2.2 追加笔记

报告创建后，如果竞品有新增笔记，用户可以手动追加导入到现有报告中。

- **对话框字段顺序**（从上到下）：报告名称（显示，不可修改）、品牌选择（多选，至少选1个，默认值为报告内所有笔记涉及的品牌集合，可修改）、时间范围（可选，默认留空，可修改）
- **品牌选择**：支持多选品牌，至少需要选择1个品牌，默认选中报告内所有笔记涉及的品牌集合，用户可修改
- **时间范围选择**：选择开始日期和结束日期，默认留空，用户可自由选择
- **动态计算**：当品牌或时间范围变化时，系统自动计算符合新筛选条件且不在当前报告中的笔记数（增量），计算过程中按钮禁用，计算完成后显示笔记数量并恢复按钮可用
- **笔记数量显示**：在筛选条件下方另起一行显示，格式为"将新增 X 条笔记"
- **按钮可用条件**：至少选择1个品牌，且计算完成，且将新增至少1条笔记
- **已忽略笔记处理**：如果笔记ID已在报告中（无论正常或已忽略状态），都视为已存在，不重复添加
- **批量追加**：将新增笔记批量添加到报告中（自动去重）

### 2.3 笔记状态管理

用户可以对报告中的笔记进行状态管理，以确保分析数据的准确性。

- **忽略笔记**：将笔记标记为忽略状态，不参与分析
- **删除笔记**：从报告中移除笔记
- **恢复笔记**：恢复被忽略或删除的笔记

### 2.4 报告展示

- **分析报告页**：在分析报告页上通过下拉列表显示用户创建的所有报告，用户选择报告后跳转到报告详情页
- **报告详情页**：显示报告信息和关联的笔记列表

## 3. 流程细化

### 3.1 创建报告流程

1. 用户进入报告创建页面，打开创建报告对话框
2. 对话框显示字段（从上到下）：
   - 报告名称（必填，8-20字）
   - 品牌选择（多选，至少选1个）
   - 时间范围（可选）
3. 用户选择品牌（至少选1个）或时间范围
4. 系统自动触发计算，计算符合条件的笔记总数（计算过程中按钮禁用）
5. 计算完成后，在筛选条件下方显示笔记数量（格式："共找到 X 条笔记"），按钮恢复可用
6. 用户输入报告名称（8-20字）
7. 当满足按钮可用条件时（报告名称已填写且至少1个品牌，且计算完成，且至少1条有效笔记），点击"创建报告"按钮
8. 系统批量导入符合条件的笔记到新报告中
9. 跳转到报告详情页

### 3.2 追加笔记流程

1. 用户在报告详情页点击"追加笔记"按钮
2. 系统打开追加笔记对话框
3. 对话框显示字段（从上到下）：
   - 报告名称（显示，不可修改）
   - 品牌选择（多选，至少选1个，默认值为报告内所有笔记涉及的品牌集合，可修改）
   - 时间范围（可选，默认留空，可修改）
4. 用户修改品牌选择或时间范围（品牌至少选1个）
5. 系统自动触发计算，计算符合新筛选条件且不在当前报告中的笔记数（增量，计算过程中按钮禁用）
6. 计算完成后，在筛选条件下方显示笔记数量（格式："将新增 X 条笔记"），按钮恢复可用
7. 当满足按钮可用条件时（至少1个品牌，且计算完成，且将新增至少1条笔记），点击"确认追加"按钮
8. 系统批量将新增笔记添加到报告中（自动去重，笔记ID已在报告中无论正常或已忽略状态都视为已存在）
9. 刷新报告详情页

### 3.3 笔记状态管理流程

#### 3.3.1 忽略笔记

1. 用户在报告详情页的笔记列表中，选择一条或多条笔记
2. 点击"忽略"按钮
3. 系统将笔记标记为忽略状态
4. 笔记在列表中显示为忽略状态（不参与分析）

#### 3.3.2 删除笔记

1. 用户在报告详情页的笔记列表中，选择一条或多条笔记
2. 点击"删除"按钮
3. 系统弹出确认对话框
4. 用户确认删除
5. 系统物理删除笔记（从报告中移除，无法恢复）
6. 笔记从列表中消失
7. 如果所有笔记都被删除，该报告不会显示在分析报告页的下拉列表中

#### 3.3.3 恢复笔记

1. 用户在报告详情页切换到"已忽略"标签
2. 选择需要恢复的笔记
3. 点击"恢复"按钮
4. 系统将笔记恢复到正常状态
5. 笔记重新出现在正常列表中

### 3.4 报告展示流程

#### 3.4.1 报告选择

1. 用户在分析报告页面通过下拉列表查看所有报告
2. 系统在下拉列表中显示所有报告（按创建时间倒序）
3. 用户从下拉列表选择报告，跳转到报告详情页

#### 3.4.2 报告详情页

1. 用户进入报告详情页
2. 显示报告基本信息：名称、创建时间、统计时间范围（最早和最新笔记时间，包含已忽略笔记）
3. 显示笔记统计信息：有效笔记数、已忽略笔记数
4. 显示笔记列表（默认显示"有效笔记"tab）
5. 支持切换"有效笔记"和"已忽略"两个tab
6. 支持笔记筛选和搜索
7. 支持批量操作（忽略、删除、恢复）

## 4. 交互UI设计方案

### 方案一：传统模态对话框 + 表格列表

#### 4.1.1 创建/追加报告对话框
- **布局**：居中模态对话框，宽度600px
- **表单布局**：垂直堆叠，字段间间距24px
- **品牌选择**：下拉多选框，支持搜索，显示已选品牌数量
- **时间范围**：两个日期选择器并排，中间显示"至"
- **笔记数量**：显示在表单底部，独立一行，使用提示文字样式
- **按钮**：对话框底部右侧，主按钮"创建报告"/"确认追加"，次要按钮"取消"

#### 4.1.2 报告详情页
- **顶部信息区**：报告名称、创建时间、统计信息（卡片式布局，3列）
- **操作栏**：顶部右侧，"追加笔记"按钮 + 搜索框
- **Tab切换**：标签页式，"有效笔记" | "已忽略"
- **笔记列表**：表格形式，首列复选框，支持全选，列包括：标题、品牌、发布时间、操作
- **批量操作栏**：选中笔记后，在列表顶部显示浮动工具栏，包含"忽略"、"删除"按钮
- **已忽略tab**：同样的表格布局，操作栏显示"恢复"按钮

#### 4.1.3 分析报告页
- **报告选择**：页面顶部下拉选择框，宽度300px，右侧显示创建时间

