---
标题: 笔记内容标签化功能规格
Owner: 产品（TBD）
状态: 待批准
Canonical: true
Links:
  业务规则: ../../05_核心业务逻辑/笔记标签化业务逻辑.md
  UI规格: ../../02_UI设计/02_原型与线框图/笔记标签化页面设计.md
  API规格: ../../03_技术实现/05_API接口契约/API_笔记标签化接口.md
  测试用例: ../../04_质量保证/02_测试用例/笔记标签化功能测试用例.md
---

# 笔记内容标签化功能规格

> 口径以"业务规则"文档为准，本文仅描述范围、用户诉求与验收标准。

## 1. 功能概述

笔记内容标签化功能用于为笔记系统引入一个强大且灵活的标签体系。它允许数据分析师从不同维度对笔记进行分类和场景化标记，从而极大地提升内容分析效率。

**功能位置**：
- **标签管理页面**：位于 `/dashboard/tags`，用于管理标签系列和标签
- **笔记打标页面**：位于 `/dashboard/notes/tagging`，专门的笔记打标页面，支持单篇和批量打标操作

**功能作用**：
- 提供多维度的笔记分类能力，支持系统预设和用户自定义标签系列
- 支持单篇和批量笔记打标操作

## 2. 核心功能

### 2.1 标签体系管理

#### 2.1.1 标签系列类型

- **系统标签系列**：由系统预设，对所有用户可见。标签系列和其中的标签由管理员统一维护，用户不可编辑或删除。保证平台核心分类标准的一致性。
- **用户自定义标签系列**：由用户为满足个人或特定项目需求而创建。用户对其拥有完全的管理权限（创建、重命名、删除）。

#### 2.1.2 标签系列管理

- **查看标签体系**：在标签管理页面查看所有可用的标签系列，清晰区分"系统标签系列"和"我创建的标签系列"；每个标签系列以单行展示，系列名称后串接该系列下所有标签（以逗号分隔），行尾提供操作区（系统系列操作区置灰，用户系列提供`编辑`按钮）
- **创建自定义标签系列**：输入系列名称创建新的标签系列，创建时可选择同时创建初始标签，也允许创建空标签系列
- **编辑与删除自定义标签系列**：支持重命名自定义标签系列；删除标签系列时会级联删除其下的所有标签，并自动解除这些标签与所有笔记的关联，操作前需二次确认
- **管理标签**：在用户自定义的标签系列下，支持添加新标签、重命名已有标签、删除标签；系统标签系列下的标签不可被用户编辑或删除

### 2.2 笔记打标操作

笔记打标操作仅在笔记打标页面（`/dashboard/notes/tagging`）进行，该页面是专门的笔记打标工作台，提供完整的打标功能。

#### 2.2.1 笔记打标页面功能

- **页面布局**：页面包含两个筛选区域、笔记列表区域、批量操作工具栏
- **笔记展示**：以表格列表形式展示笔记，字段与`全部笔记 -> 笔记列表`保持一致
- **筛选功能**：
  - 置顶筛选区：仅包含"标签系列"选择器（必选）。未选择标签系列时，不展示笔记列表并提示选择标签系列
  - 二级筛选区：与笔记列表一致的常规筛选项（品牌、博主、日期范围等），并新增"我的报告"选择器、"标签：未打标"开关（默认开启），以及所选标签系列下的标签列表（用于辅助定位未打标或特定标签的笔记）
- **标签展示**：每篇笔记下方清晰展示已打上的标签，支持快速查看和移除
- **标签编辑列**：表格右侧固定一列展示标签下拉框
  - 默认值为该笔记在当前标签系列下已保存的标签集合；若未保存过则为空
  - 用户可在下拉框中调整标签选择或清空当前笔记的标签，保存后即时更新

#### 2.2.2 单篇笔记打标

- **打标入口**：在笔记列表右侧固定的标签编辑列中，点击标签下拉选择器
- **标签选择器**：基于 Ant Design `Select` 组件，展示当前所选标签系列下的全部标签，支持搜索
- **打标操作**：在下拉框中选择或移除标签项，失焦时自动保存并出现加载状态，保存完成后下拉框选项即时更新
- **清空能力**：点击下拉框右侧的清空图标即可移除当前系列下的全部已选标签
- **实时反馈**：保存过程通过下拉框内的 loading 状态提示，保存完成后筛选结果与展示同步更新

#### 2.2.3 批量笔记打标

- **批量选择**：在笔记打标页面，通过复选框选择多篇笔记，支持全选、反选、按条件选择
- **批量操作工具栏**：位于表格右上角，包含"批量打标"与"批量清除"按钮；未选择笔记时按钮置灰不可用，勾选笔记后自动变为可点击状态
- **批量打标**：点击"批量打标"按钮，弹出标签选择器，选择要应用的标签，确认后为所有选中的笔记批量添加这些标签
- **批量清除**：点击"批量清除"按钮，直接删除选中笔记与当前标签系列下所有标签的关联关系（物理删除），操作前弹出二次确认
- **操作反馈**：批量操作完成后显示操作结果提示（成功数量、失败数量及失败原因）

#### 2.2.4 笔记打标页面筛选

- **筛选区划分**：
  - 置顶筛选区（第一行）：仅包含"标签系列"选择器（必选）。未选择时，不展示笔记列表与批量工具栏，显示空表格及提示"请先选择标签系列"
  - 二级筛选区（第二行）：包含与笔记列表一致的筛选项（品牌、博主、日期范围等）+
    - "我的报告"选择器：可限定为某个报告范围内的笔记
    - 标签筛选下拉：包含"未打标"选项与当前标签系列下的标签列表，二者位于同一个下拉框内；默认"未打标"，单选（与其他筛选条件组合），也可不选。
- **筛选逻辑**：
  - 默认选中"未打标"，返回当前所选标签系列下未被打任一标签的笔记
  - 若选择具体标签，则展示至少包含该标签的笔记（限定在当前所选标签系列）
  - 清空选择时，标签筛选不生效，可配合其他筛选条件单独使用
- **筛选结果**：筛选结果实时更新笔记列表；筛选条件在筛选区内展示，支持清除单个或全部条件

## 3. 功能流程

### 3.1 标签体系管理流程

#### 3.1.1 查看标签体系

1. 用户进入标签管理页面（`/dashboard/tags`）
2. 系统加载所有标签系列（系统标签系列 + 用户自定义标签系列）
3. 页面展示标签系列列表，清晰区分系统标签系列和用户自定义标签系列
4. 列表中每个标签系列占据单行：系列名称后以逗号串联展示该系列下的所有标签，行尾显示操作区（系统系列操作区置灰，用户系列提供`编辑`按钮）
5. 系统标签系列显示"系统"标识，且管理操作按钮置灰或隐藏

#### 3.1.2 创建自定义标签系列

1. 用户点击"新建标签系列"按钮
2. 弹出创建标签系列对话框
3. 用户输入系列名称（必填，例如"2025双十一项目"，需满足4~20个字符，中文按字数计算）
4. 用户创建至少一个标签（必填，可继续新增多个标签）
5. 用户为每个标签填写名称（需满足4~20个字符，中文按字数计算）
6. 用户点击"确认"创建标签系列
7. 系统验证：系列名称与标签名称均需满足4~20个字符长度限制（中文按字数计算）、不可为空、不可重复
8. 创建成功后，标签系列出现在"我创建的标签系列"列表中

#### 3.1.3 编辑自定义标签系列

1. 用户在"我创建的标签系列"列表中找到目标标签系列
2. 点击操作列中的`编辑`按钮
3. 弹出标签系列编辑弹窗，顶部展示标签系列名称，正文展示该系列下的所有标签
4. 用户将鼠标悬停在系列名称上，触发右侧的编辑 icon，点击进入就地编辑模式，更新系列名称
5. 失焦或按 Enter 后自动保存，系统校验名称（不能为空、不能重复，长度需在4~20个字符之间，中文按字数计算）
6. 保存成功时页面顶部出现成功提示，弹窗保持打开状态

#### 3.1.4 删除自定义标签系列

1. 用户在"标签系列"列表中，操作区点击"删除"
2. 弹出二次确认对话框，提示：
   - 删除该标签系列将级联删除其下的所有标签
   - 将自动解除这些标签与所有笔记的关联
   - 此操作不可恢复
3. 用户确认删除
4. 系统执行删除操作：
   - 删除标签系列记录
   - 级联删除该系列下的所有标签记录
   - 删除所有笔记与这些标签的关联关系
5. 删除成功后，标签系列从列表中移除

#### 3.1.5 管理标签（在自定义标签系列下）

1. **添加标签**：
   - 在标签系列编辑弹窗中，点击标签列表底部的"添加标签"按钮
   - 新增标签行立即进入就地编辑模式，输入标签名称（必填，不能为空、不能重复，长度需在4~20个字符之间，中文按字数计算）
   - 失焦或按 Enter 后自动保存，新增标签即时出现在列表中

2. **重命名标签**：
   - 将鼠标悬停在目标标签上，显示标签名称右侧的编辑 icon
   - 点击 icon 进入就地编辑模式，更新标签名称
   - 失焦或按 Enter 后自动保存，系统完成校验后更新标签

3. **删除标签**：
   - 在标签系列编辑弹窗的标签行中点击"删除"按钮
   - 弹出确认对话框，提示将解除该标签与所有笔记的关联
   - 确认后删除标签，并删除所有笔记与该标签的关联关系

### 3.2 笔记打标流程

#### 3.2.1 进入笔记打标页面

1. 用户通过导航菜单或链接进入笔记打标页面（`/dashboard/notes/tagging`）
2. 页面初始化：展示空表格状态，提示"请先选择标签系列"，笔记列表与批量工具栏暂不展示
3. 在置顶筛选区选择目标标签系列后，系统加载该系列下的全部标签
4. 加载完成即展示笔记列表，每行包含标题、内容预览、已打标签、标签编辑列等信息
5. 二级筛选区的标签下拉框默认选中"未打标"选项，可结合常规筛选项与"我的报告"筛选笔记

#### 3.2.2 单篇笔记打标

1. 在笔记列表右侧的标签编辑列找到目标笔记的标签选择器
2. 点击选择器展开下拉框，展示当前标签系列下的全部标签及搜索框（已保存的标签默认勾选）
3. 勾选或取消勾选标签项，实时调整待保存的标签集合
4. 失焦或按 Enter 后自动保存，选择器展示 loading 状态并完成校验
5. 保存成功后，下拉框自动收起并即时刷新该笔记展示的标签，可通过标签上的"×"快速移除单个标签

#### 3.2.3 批量笔记打标

1. 通过表格左侧复选框选择多篇笔记（支持单选、多选、全选当前页）
2. 选中后，表格右上出现批量操作工具栏，实时显示已勾选的笔记数量
3. 点击"批量打标"按钮，弹出标签选择器（同单篇笔记打标）
4. 勾选要应用的标签，点击"确认"按钮
5. 系统为所有选中的笔记批量添加所选标签，并显示操作结果（成功数、失败数及原因）
6. 操作完成后，笔记列表与标签展示即时刷新

#### 3.2.4 批量清除

1. 通过复选框选择需要清除标签的笔记
2. 点击批量操作工具栏中的"批量清除"按钮
3. 弹出二次确认对话框，说明将删除选中笔记在当前标签系列下的全部标签关联且不可撤销
4. 用户确认执行，系统批量清除关联关系并返回成功/失败明细
5. 清除完成后，笔记列表即时更新，相关标签全部移除

#### 3.2.5 在笔记打标页面筛选笔记

1. 在置顶筛选区选择"标签系列"（必选）。未选择时，展示空状态提示"请先选择标签系列"
2. 选择标签系列后，二级筛选区生效，可使用品牌、博主、日期范围等常规筛选项
3. 二级筛选区的标签下拉框默认处于"未打标"选项，返回当前系列下未打任一标签的笔记
4. 可结合"我的报告"筛选范围；如需按标签筛选，先取消"标签：未打标"后从标签列表中单选目标标签
5. 筛选条件应用后即时刷新笔记列表，条件条展示在筛选区域，可清除单个或全部条件
6. 表格右侧的标签编辑列始终与筛选结果同步，支持直接调整并即时保存标签

## 4. 业务规则

### 4.1 验证规则

#### 4.1.1 标签系列名称验证

1. **必填验证**：标签系列名称不能为空
2. **长度限制**：4~20个字符（中文按字数计算）
3. **唯一性验证**：同一用户下，标签系列名称不能重复（系统标签系列不计入）
4. **字符类型**：支持中文、英文、数字、常用符号

#### 4.1.2 标签名称验证

1. **必填验证**：标签名称不能为空
2. **长度限制**：4~20个字符（中文按字数计算）
3. **唯一性验证**：同一标签系列下，标签名称不能重复
4. **字符类型**：支持中文、英文、数字、常用符号


### 4.2 计算规则

#### 4.2.1 标签筛选计算规则

1. **标签列表单选（当前标签系列内）**：
   - 选择单个标签时，展示至少包含该标签的笔记（仅限于当前所选标签系列）

2. **未打标筛选（当前标签系列内）**：
   - 默认开启，返回在当前所选标签系列下未打任何标签的笔记
   - 与标签列表单选互斥；如同时选择，优先"未打标"

3. **筛选范围与组合**：
   - 仅筛选当前用户有权限查看的笔记
   - 可与品牌、博主、日期范围、我的报告等条件组合

### 4.3 数据更新规则

所有标签系列、标签及笔记打标的增删改操作需在 Supabase 中记录触发该操作的用户 Supabase UID 与操作时间，用于审计与追踪。

#### 4.3.1 标签系列创建规则

1. **创建时机**：用户点击"确认"后立即创建
2. **数据存储**：标签系列记录包含：系列ID、系列名称、创建者 Supabase UID、创建时间、是否系统标签系列
3. **权限控制**：只有创建者可以编辑和删除自己创建的标签系列

#### 4.3.2 标签系列删除规则

1. **级联删除**：
   - 删除标签系列时，自动删除该系列下的所有标签
   - 自动删除所有笔记与这些标签的关联关系

2. **数据一致性**：
   - 使用事务确保删除操作的原子性
   - 删除失败时回滚所有操作

3. **操作审计**：记录执行删除操作的 Supabase UID 与操作时间
4. **影响范围**：
   - 仅影响当前用户创建的标签系列
   - 系统标签系列不可删除

#### 4.3.3 标签创建规则

1. **创建时机**：用户点击"确认"后立即创建
2. **数据存储**：标签记录包含：标签ID、标签名称、所属标签系列ID、创建者 Supabase UID、创建时间、最近操作 Supabase UID、最近操作时间
3. **权限控制**：
   - 用户自定义标签系列下的标签：创建者可以编辑和删除
   - 系统标签系列下的标签：用户不可编辑和删除

#### 4.3.4 标签删除规则

1. **关联清理**：删除标签时，自动删除所有笔记与该标签的关联关系
2. **数据一致性**：使用事务确保删除操作的原子性，并记录执行删除的 Supabase UID 与操作时间

#### 4.3.5 笔记打标规则

1. **关联创建**：
   - 为笔记打标时，创建笔记与标签的多对多关联记录
   - 如果关联已存在，跳过（避免重复）

2. **关联删除**：
   - 移除笔记标签时，删除对应的关联记录
   - 如果关联不存在，跳过（幂等操作）

3. **操作审计**：记录每次单笔或批量打标/清除操作的 Supabase UID 与操作时间
4. **批量操作**：
   - 批量打标时，为每篇笔记创建关联记录
   - 使用批量插入优化性能
   - 部分失败时，返回成功和失败的数量

## 5. 异常处理

### 5.1 数据异常

#### 5.1.1 标签系列数据异常

- **标签系列不存在**：提示"标签系列不存在"，返回标签管理页面
- **标签系列已被删除**：提示"标签系列已被删除"，刷新列表
- **标签系列数据损坏**：使用系统默认配置，记录错误日志

#### 5.1.2 标签数据异常

- **标签不存在**：提示"标签不存在"，刷新标签列表
- **标签已被删除**：自动从笔记的标签列表中移除该标签，提示用户
- **标签数据损坏**：跳过该标签，记录错误日志

#### 5.1.3 笔记数据异常

- **笔记不存在**：提示"笔记不存在"，从列表中移除
- **笔记已被删除**：自动清理该笔记的所有标签关联，提示用户
- **笔记数据损坏**：跳过该笔记，记录错误日志

### 5.2 计算异常

#### 5.2.1 筛选计算异常

- **筛选条件无效**：提示"筛选条件无效，请重新选择"，清除无效筛选条件
- **筛选结果为空**：显示"未找到符合条件的笔记"空状态提示
- **筛选超时**：显示加载状态，提示"数据量较大，请稍候"，超过10秒后提示"筛选超时，请减少筛选条件或联系管理员"

### 5.3 配置异常

#### 5.3.1 标签系列配置异常

- **配置格式错误**：使用系统默认配置，记录错误日志
- **配置验证失败**：显示错误提示，不允许保存，保留当前编辑状态
- **保存失败**：显示错误提示（网络错误、权限不足等），保留当前编辑状态，允许重试

#### 5.3.2 标签配置异常

- **标签名称重复**：提示"该标签系列下已存在同名标签"，不允许保存
- **保存失败**：显示错误提示，保留当前编辑状态

### 5.4 操作异常

#### 5.4.1 打标操作异常

- **笔记不存在**：提示"笔记不存在，无法打标"，刷新列表
- **标签不存在**：提示"标签不存在"，从选择器中移除该标签
- **批量操作部分失败**：显示成功和失败的数量，列出失败原因
- **网络错误**：提示"网络错误，请检查网络连接后重试"，允许重试
