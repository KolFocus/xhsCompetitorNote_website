# 达人矩阵分析页面设计

## 1. 设计概述

本文档详细描述达人矩阵属性分析功能的UI设计，包括统计表格、配置弹窗等组件的具体设计方案。

### 1.1 设计原则
- 遵循 antd 5.x 设计规范
- 保持与报告功能页面风格一致
- 简洁明了的交互流程
- 清晰的视觉反馈

### 1.2 技术组件
使用 antd 5.x 组件库，包括 Card、Table、Modal、Form、Input、Button、Space 等组件。

---

## 2. 整体布局

### 2.1 位置

**位置**：报告详情页顶部，位于报告信息卡片区域下方、筛选器区域上方

**布局结构**：
```
┌─────────────────────────────────────────────────────────┐
│  报告信息卡片区域（3个卡片）                             │
├─────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────┐  │
│  │  达人矩阵属性分析                    [配置] 按钮   │  │
│  │  ┌─────────────────────────────────────────────┐  │  │
│  │  │  统计表格（见2.2）                          │  │  │
│  │  └─────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────┤
│  筛选器区域                                              │
└─────────────────────────────────────────────────────────┘
```

### 2.2 组件说明

- **标题区域**：显示"达人矩阵属性分析"标题（使用中标题样式，参考设计规范）
- **操作按钮**：右上角显示"配置"按钮（次要按钮样式）
- **表格区域**：展示统计数据表格

---

## 3. 统计表格UI

### 3.1 表格规格

- **组件**：Table
- **样式**：参考设计规范的表格规范
- **滚动**：支持横向滚动（当列数较多时），`scroll={{ x: 1200 }}`
- **表头**：固定，支持排序（可选功能）
- **行高**：适中，确保数据可读性

### 3.2 列定义

| 列名 | 宽度 | 对齐 | 说明 | 示例数据 |
|------|------|------|------|----------|
| **层级名称** | 150px | 左对齐 | 显示层级名称，知名KOL有特殊标识 | "知名KOL" / "头部达人" |
| **粉丝数范围** | 150px | 左对齐 | 自定义层级显示由阈值自动生成的范围（展示为友好格式：`≥50万` 或 `10万-50万`，底层逻辑为上闭区间`(X, Y]`）；知名KOL行显示“加V达人（OfficialVerified=true）”；总计行显示“-” | "加V达人" / "≥50万" / "10万-50万" / "-" |
| **达人数量** | 120px | 右对齐 | 该层级的达人总数 | 15 |
| **达人占比** | 100px | 右对齐 | 占所有达人的百分比，带%符号 | 12.5% |
| **平均粉丝数** | 120px | 右对齐 | 该层级达人的平均粉丝数，格式化显示 | 85.2万 |
| **总互动量** | 120px | 右对齐 | 该层级所有笔记的互动量总和（点赞+收藏+评论+分享），格式化显示 | 125.6万 |
| **互动量占比** | 100px | 右对齐 | 占所有互动量的百分比 | 35.8% |
| **笔记数量** | 120px | 右对齐 | 该层级达人的笔记总数 | 234 |
| **笔记占比** | 100px | 右对齐 | 占所有笔记的百分比 | 18.2% |

### 3.3 视觉设计

#### 3.3.1 知名KOL行

- **背景色**：浅蓝色（#e6f7ff）或浅金色（#fffbe6），与其他行区分
- **层级名称**：可选在名称前添加图标标识（如：⭐）
- **粉丝数范围**：显示“加V达人（OfficialVerified=true）”

#### 3.3.2 总计行

- **背景色**：浅灰色（#fafafa）
- **字体**：加粗
- **分隔线**：用分隔线与上方数据区分
- **占比列**：所有占比列均显示100.0%

#### 3.3.3 数字格式化

- **粉丝数、互动量**：
  - ≥1万显示为"X.X万"（保留1位小数）
  - <1万显示原数字（如：0.8万）
- **占比**：
  - 保留1位小数，带%符号（如：12.5%）
  - 总计行显示100.0%

#### 3.3.4 对齐方式

- **文字列**（层级名称、粉丝数范围）：左对齐
- **数字列**（达人数量、占比、平均粉丝数等）：右对齐

### 3.4 交互功能

- **鼠标悬停**：行高亮显示（背景色：#fafafa）
- **点击表头**：按该列排序（可选功能）
- **空状态**：显示空状态提示："暂无数据"或"该报告暂无有效笔记"

### 3.5 表格数据示例

假设默认配置为：
- **知名KOL**：官方认证达人（加V达人，OfficialVerified=true；不参与粉丝分层）
- **头部达人**：粉丝数 ≥ 50万
- **腰部达人**：粉丝数 10万 - 50万
- **初级达人**：粉丝数 1万 - 10万
- **新手达人**：粉丝数 < 1万

表格展示效果：

```
┌──────────────┬──────────────┬──────────┬──────────┬──────────────┬──────────────┬──────────────┬──────────┬──────────┐
│ 层级名称     │ 粉丝数范围   │ 达人数量 │ 达人占比 │ 平均粉丝数   │ 总互动量     │ 互动量占比   │ 笔记数量 │ 笔记占比 │
├──────────────┼──────────────┼──────────┼──────────┼──────────────┼──────────────┼──────────────┼──────────┼──────────┤
│ ⭐ 知名KOL   │ 加V达人       │ 15       │ 12.5%    │ 85.2万       │ 125.6万      │ 35.8%        │ 234      │ 18.2%    │
│ 头部达人     │ ≥50万        │ 28       │ 23.3%    │ 78.5万       │ 156.3万      │ 44.6%        │ 312      │ 24.3%    │
│ 腰部达人     │ 10万-50万    │ 42       │ 35.0%    │ 28.6万       │ 58.2万       │ 16.6%        │ 456      │ 35.5%    │
│ 初级达人     │ 1万-10万     │ 25       │ 20.8%    │ 5.2万        │ 8.5万        │ 2.4%         │ 198      │ 15.4%    │
│ 新手达人     │ <1万         │ 10       │ 8.3%     │ 0.8万        │ 1.4万        │ 0.4%         │ 87       │ 6.8%     │
├──────────────┼──────────────┼──────────┼──────────┼──────────────┼──────────────┼──────────────┼──────────┼──────────┤
│ 总计         │ -            │ 120      │ 100.0%   │ 35.8万       │ 350.0万      │ 100.0%       │ 1287     │ 100.0%   │
└──────────────┴──────────────┴──────────┴──────────┴──────────────┴──────────────┴──────────────┴──────────┴──────────┘
```

---

## 4. 配置弹窗UI

### 4.1 弹窗规格

- **宽度**：600px（参考设计规范中的中对话框规格）
- **位置**：居中显示
- **标题**："达人矩阵配置"

### 4.2 弹窗布局

```
┌──────────────────────────────────────────────────────────────────────────────┐
│ 达人矩阵配置                                                        [×] 关闭 │
├───────┬────────────┬──────────────────┬───────────────────────┬─────────┤
│ 顺序  │ 层级名称 输入   │ 粉丝数阈值（>）输入  │ 当前层范围（自动计算） │ 操作    │
├───────┼────────────┼──────────────────┼───────────────────────┼─────────┤
│ 1     │ 知名KOL     │ 固定：加V达人     │ 不参与粉丝分层；先行筛选 │ -       │
│       │ （不可编辑）│ （OfficialVerified=true） │                       │         │
├───────┼────────────┼──────────────────┼───────────────────────┼─────────┤
│ 2     │ 头部达人    │ > 500,000        │ (500,000, 上一行阈值]  │ 删除    │
├───────┼────────────┼──────────────────┼───────────────────────┼─────────┤
│ 3     │ 腰部达人    │ > 100,000        │ (100,000, 500,000]    │ 删除    │
├───────┼────────────┼──────────────────┼───────────────────────┼─────────┤
│ 4     │ 尾部达人    │ > 0              │ (0, 100,000]          │ 删除    │
├───────┴────────────┴──────────────────┴───────────────────────┴─────────┤
│ [+ 添加层级]  （追加到表格末尾；不支持中间插入与拖拽重排）                                  │
├──────────────────────────────────────────────────────────────────────────────┤
│ 规则提示：                                                                    │
│ - 阈值必须严格递减：当前行“>X” < 上一行阈值；相等或反向会标红并给出“一键修正”。              │
│ - 删除中间行：后续行的“>X”不变，所有范围自动重算并自然衔接。                               │
│ - 最后一行建议下界为 >0；如设为 >10,000，则范围为 (10,000, 上一行阈值]。                    │
│ - 边界落点归属上层（上闭）。例如粉丝=500,000 归属上一层（若上一层上界为500,000）。          │
│ - 知名KOL为加V达人集合，先从列表中筛出（OfficialVerified=true），剩余达人再按阈值分层。       │
├──────────────────────────────────────────────────────────────────────────────┤
│ [保存]  [重置为上次保存]  [恢复默认模板]                                        │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 4.3 配置项说明

#### 4.3.1 知名KOL层

- **定义**：指加V达人，即 `OfficialVerified = true`，与粉丝数无关
- **显示**：固定在第1行，不可编辑
- **层级名称**：显示"知名KOL"（置灰）
- **粉丝数阈值**：固定为“加V达人（OfficialVerified=true）”
- **当前层范围**：显示“ 不参与粉丝分层；先从达人列表中筛选出该集合 ”
- **计算顺序**：先从达人列表抽取加V达人集合用于单独汇总；余下达人再进入粉丝数分层

#### 4.3.2 自定义层级列表

- **布局**：表格行（紧随第1行知名KOL之后）
- **列与控件**：
  - 顺序：只读序号
  - 层级名称：Input（可编辑）
  - 粉丝数阈值（>）：InputNumber（仅录入阈值X，表示"> X"）
  - 当前层范围：只读文本，自动根据“本行阈值X”和“上一行阈值Y”计算为"(X, Y]"
  - 操作：删除（危险样式）
- **交互**：
  - 内联编辑，实时计算“当前层范围”
  - 点击"删除"直接删除（无二次确认）
  - 至少保留一行自定义层级（最后一行时隐藏或禁用删除）

#### 4.3.3 添加层级

- **按钮**："+ 添加层级"
- **位置**：表格末尾
- **行为**：仅支持在末尾追加新行；不支持中间插入与拖拽重排；新行进入编辑态

#### 4.3.4 编辑层级

- **内联编辑**：可编辑字段仅包括“层级名称”和“粉丝数阈值（>）”
- **自动范围**：“当前层范围”只读，由系统根据阈值自动计算与展示
- **占位符**：
  - 层级名称："请输入层级名称"
  - 粉丝数阈值："仅输入数字，表示 >X"
- **保存**：点击"保存"进行整体保存（非逐行保存）
- **取消**：关闭弹窗即取消本次修改；若有未保存修改则二次确认

#### 4.3.5 删除层级

- **按钮**：删除按钮（危险按钮样式）
- **确认**：无二次确认
- **范围联动**：删除中间行后，后续行阈值保持不变，所有“当前层范围”自动重算并自然衔接
- **限制**：至少保留一个自定义层级（删除按钮在只剩一个层级时禁用或隐藏）

#### 4.3.6 操作按钮

- **保存按钮**：
  - 主要按钮样式（参考设计规范）
  - 文字："保存"
  - 功能：保存当前配置到数据库（保存前弹出二次确认），关闭弹窗，刷新统计数据
  - 状态：点击时进行校验；若校验失败则不提交并提示错误
- **重置按钮**：
  - 次要按钮样式（参考设计规范）
  - 文字："重置为上次保存"
  - 功能：恢复到上次成功保存的配置，不保存到服务器，仅更新弹窗表单
- **恢复默认按钮**：
  - 次要按钮样式
  - 文字："恢复默认模板"
  - 功能：将当前表格恢复到平台默认模板（本地预览）；需点击"保存"才会落库
- **关闭按钮**：
  - 右上角关闭按钮
  - 功能：关闭弹窗，不保存修改
  - 若存在未保存的修改，弹出确认提示：“有未保存的修改，关闭后将不会保存。”

### 4.4 验证提示

- **层级名称为空**：提示"层级名称不能为空"
- **层级名称重复**：提示"层级名称已存在，请使用其他名称"
- **阈值严格递减**：从上到下必须满足 本行X < 上一行阈值Y；相等或大于将标红并提供“一键修正”为 Y-1
- **边界归属**：采用上闭区间，上界值归属上一层
- **阈值下限**：最后一行建议 >0；允许设置任意非负整数
- **删除影响**：删除任一行后，后续行阈值不改动，仅自动重算范围
- **范围展示**：范围为"(当前行X, 上一行阈值Y]"；知名KOL固定为"[1,000,000, +∞)"
- **人群范围**：分层仅作用于“非加V达人（OfficialVerified=false）”；知名KOL集合不参与阈值校验与范围计算

### 4.5 输入框规格

- **层级名称输入框**：
  - 宽度：100%
  - 占位符："请输入层级名称"
  - 最大长度：20个字符
- **粉丝数阈值输入框**：
  - 形式：单个数字输入框（InputNumber），仅输入阈值X，含义为"> X"
  - 占位符："仅输入数字，表示 >X"
  - 校验：必须为非负整数；且严格小于上一行阈值
  - 范围说明：相邻两行自动生成区间文本，不可手动修改

---

## 5. 加载状态

### 5.1 数据加载时

- **表格区域**：显示加载动画（Spin组件，tip="加载中..."）
- **配置按钮**：禁用状态

### 5.2 数据为空时

- **表格区域**：显示空状态提示（Empty组件）
- **提示文字**："暂无数据"或"该报告暂无有效笔记"
- **图标**：FileTextOutlined（64px，使用次要文字色）

### 5.3 计算中

- **表格区域**：显示加载动画
- **提示文字**："正在计算统计数据..."

---

## 6. 交互状态说明

### 6.1 配置修改

- **编辑状态**：输入框高亮显示（边框色：#1890ff）
- **保存成功**：使用 message.success() 显示成功提示
- **保存失败**：使用 message.error() 显示错误提示

### 6.2 数据刷新

- **自动刷新**：配置保存后、报告数据更新后自动刷新统计数据
- **手动刷新**：提供刷新按钮（可选）

### 6.3 错误处理

- **配置验证失败**：显示错误提示，不允许保存
- **保存失败**：显示错误提示，保留当前编辑状态
- **数据加载失败**：显示错误提示，提供重试按钮

---

## 7. 组件使用说明

主要使用的 antd 组件：
- **Card**：包裹整个达人矩阵分析板块
- **Table**：展示统计数据表格
- **Modal**：配置弹窗
- **Form**：配置表单
- **Input**：层级名称和粉丝数范围输入
- **Button**：配置、保存、重置、删除等按钮
- **Space**：按钮组间距
- **Spin**：加载状态
- **Empty**：空状态

---

## 8. 设计确认清单

### 8.1 统计表格
- [x] 表格宽度和滚动设置
- [x] 列定义（9列）
- [x] 知名KOL行特殊样式
- [x] 总计行特殊样式
- [x] 数字格式化规则
- [x] 对齐方式设置
- [x] 空状态显示

### 8.2 配置弹窗
- [x] 弹窗宽度600px
- [x] 知名KOL层固定显示
- [x] 自定义层级列表
- [x] 添加层级功能
- [x] 编辑层级功能
- [x] 删除层级功能
- [x] 保存和重置按钮
- [x] 验证提示显示

### 8.3 交互状态
- [x] 加载状态显示
- [x] 空状态显示
- [x] 错误处理
- [x] 成功提示

---

## 9. 后续优化建议

1. **图表展示**：支持将统计数据可视化展示（饼图、柱状图等）
2. **导出功能**：支持导出达人矩阵统计数据为Excel/CSV
3. **排序功能**：支持按任意数字列排序
4. **筛选功能**：支持按层级筛选笔记列表
5. **对比分析**：支持对比不同报告的达人矩阵数据

