---
标题: 报告功能测试用例（已废弃）
状态: 已废弃
Deprecated: true
替代文档:
  - 质量保证_达人矩阵测试用例: ../04_质量保证/02_测试用例/达人矩阵分析功能测试用例.md
说明: 本文为早期报告功能通用测试用例，涉及达人矩阵部分已被更细化的质量保证文档替代。请优先以“质量保证/测试用例”目录中的文档为准。
---
# 报告功能测试用例

## 1. API接口测试用例

### TC-API-REPORT-001: 创建报告

**描述**: 验证创建报告接口功能  
**前置条件**: 用户已登录，存在品牌数据  
**测试步骤**:
1. 调用 `POST /api/reports` 接口
2. 传入有效的报告名称、品牌ID数组、时间范围
3. 检查响应

**测试数据**:
```json
{
  "reportName": "2024年Q1竞品分析报告",
  "brandIds": ["46899"],
  "startDate": "2024-01-01",
  "endDate": "2024-03-31"
}
```

**预期结果**: 
- 返回成功响应
- 报告ID不为空
- 笔记数量 > 0

---

### TC-API-REPORT-002: 创建报告 - 参数验证

**描述**: 验证创建报告接口的参数验证  
**测试步骤**:
1. 测试报告名称过短（< 8字符）
2. 测试报告名称过长（> 20字符）
3. 测试品牌ID数组为空
4. 测试无效的品牌ID

**预期结果**: 
- 所有无效参数都应返回400错误
- 错误信息清晰明确

---

### TC-API-REPORT-003: 获取报告列表

**描述**: 验证获取报告列表接口  
**测试步骤**:
1. 调用 `GET /api/reports` 接口
2. 检查响应数据

**预期结果**: 
- 返回当前用户的所有报告
- 按创建时间倒序排列
- 包含报告基本信息和统计信息

---

### TC-API-REPORT-004: 获取报告详情

**描述**: 验证获取报告详情接口  
**测试步骤**:
1. 创建一条测试报告
2. 调用 `GET /api/reports/[id]` 接口
3. 检查响应数据

**预期结果**: 
- 返回报告详细信息
- 包含统计信息（有效笔记数、已忽略笔记数）
- 包含时间范围信息
- 包含品牌列表

---

### TC-API-REPORT-005: 计算笔记数量

**描述**: 验证计算笔记数量接口  
**测试步骤**:
1. 调用 `POST /api/reports/calculate-notes` 接口
2. 传入品牌ID数组和时间范围
3. 检查响应

**预期结果**: 
- 返回符合条件的笔记总数
- 数量 >= 0

---

### TC-API-REPORT-006: 计算增量笔记数量

**描述**: 验证计算增量笔记数量接口  
**测试步骤**:
1. 创建一条测试报告，添加一些笔记
2. 调用 `POST /api/reports/[id]/calculate-new-notes` 接口
3. 传入品牌ID数组和时间范围
4. 检查响应

**预期结果**: 
- 返回符合条件的增量笔记数量
- 排除已在报告中的笔记
- 数量 >= 0

---

### TC-API-REPORT-007: 追加笔记到报告

**描述**: 验证追加笔记接口  
**测试步骤**:
1. 创建一条测试报告
2. 调用 `POST /api/reports/[id]/add-notes` 接口
3. 传入品牌ID数组和时间范围
4. 检查响应

**预期结果**: 
- 返回成功响应
- 返回成功添加的笔记数量
- 笔记成功添加到报告中

---

### TC-API-REPORT-008: 获取报告笔记列表

**描述**: 验证获取报告笔记列表接口  
**测试步骤**:
1. 创建一条测试报告，添加一些笔记
2. 调用 `GET /api/reports/[id]/notes` 接口
3. 测试不同筛选条件
4. 测试分页

**预期结果**: 
- 返回报告中的笔记列表
- 支持筛选和分页
- 支持排序

---

### TC-API-REPORT-009: 批量忽略笔记

**描述**: 验证批量忽略笔记接口  
**测试步骤**:
1. 创建一条测试报告，添加一些笔记
2. 调用 `POST /api/reports/[id]/notes/batch-action` 接口
3. 传入 action: "ignore" 和笔记ID数组
4. 检查笔记状态

**预期结果**: 
- 笔记状态更新为 "ignored"
- 笔记出现在"已忽略"tab中

---

### TC-API-REPORT-010: 批量删除笔记

**描述**: 验证批量删除笔记接口  
**测试步骤**:
1. 创建一条测试报告，添加一些笔记
2. 调用 `POST /api/reports/[id]/notes/batch-action` 接口
3. 传入 action: "delete" 和笔记ID数组
4. 检查笔记是否被删除

**预期结果**: 
- 笔记从报告中完全移除
- 笔记不再出现在列表中

---

### TC-API-REPORT-011: 批量恢复笔记

**描述**: 验证批量恢复笔记接口  
**测试步骤**:
1. 创建一条测试报告，添加一些笔记并忽略
2. 调用 `POST /api/reports/[id]/notes/batch-action` 接口
3. 传入 action: "restore" 和笔记ID数组
4. 检查笔记状态

**预期结果**: 
- 笔记状态更新为 "active"
- 笔记出现在"有效笔记"tab中

---

### TC-API-REPORT-012: 删除报告

**描述**: 验证删除报告接口  
**测试步骤**:
1. 创建一条测试报告，添加一些笔记
2. 调用 `DELETE /api/reports/[id]` 接口
3. 检查报告和关联笔记是否被删除

**预期结果**: 
- 报告被删除
- 关联的 report_notes 记录被级联删除

---

### TC-API-REPORT-013: 权限验证

**描述**: 验证权限控制  
**测试步骤**:
1. 用户A创建一条报告
2. 用户B尝试访问该报告
3. 用户B尝试修改该报告
4. 用户B尝试删除该报告

**预期结果**: 
- 用户B无法访问、修改、删除用户A的报告
- 返回403或404错误

---

## 2. 前端功能测试用例

### TC-FE-REPORT-001: 创建报告对话框

**描述**: 验证创建报告对话框功能  
**测试步骤**:
1. 点击"创建报告"按钮
2. 输入报告名称
3. 选择品牌
4. 选择时间范围
5. 观察笔记数量计算
6. 点击"创建报告"按钮

**预期结果**: 
- 对话框正常显示
- 品牌选择支持多选和搜索
- 时间范围选择正常
- 笔记数量自动计算
- 创建成功后跳转到报告详情页

---

### TC-FE-REPORT-002: 创建报告 - 表单验证

**描述**: 验证创建报告表单验证  
**测试步骤**:
1. 测试报告名称过短
2. 测试报告名称过长
3. 测试未选择品牌
4. 测试笔记数量为0时提交

**预期结果**: 
- 所有验证失败时按钮禁用
- 显示清晰的错误提示

---

### TC-FE-REPORT-003: 追加笔记对话框

**描述**: 验证追加笔记对话框功能  
**测试步骤**:
1. 在报告详情页点击"追加笔记"按钮
2. 观察报告名称只读显示
3. 观察品牌选择默认值
4. 修改品牌选择或时间范围
5. 观察增量笔记数量计算
6. 点击"确认追加"按钮

**预期结果**: 
- 对话框正常显示
- 报告名称只读
- 品牌选择默认值为报告内所有品牌
- 增量笔记数量自动计算
- 追加成功后刷新报告详情页

---

### TC-FE-REPORT-004: 报告详情页 - 报告选择

**描述**: 验证报告选择功能  
**测试步骤**:
1. 进入报告详情页
2. 观察报告下拉列表
3. 切换不同的报告
4. 观察页面内容刷新

**预期结果**: 
- 显示所有报告列表
- 默认选中最新创建的报告
- 切换报告时页面内容正确刷新

---

### TC-FE-REPORT-005: 报告详情页 - 空状态

**描述**: 验证报告列表为空时的空状态  
**测试步骤**:
1. 未创建任何报告时进入报告详情页
2. 观察空状态显示

**预期结果**: 
- 显示空状态提示
- 显示"创建报告"按钮
- 点击按钮打开创建报告对话框

---

### TC-FE-REPORT-006: 报告详情页 - 报告信息卡片

**描述**: 验证报告信息卡片显示  
**测试步骤**:
1. 进入报告详情页
2. 观察报告信息卡片

**预期结果**: 
- 显示报告名称
- 显示创建时间
- 显示统计时间范围

---

### TC-FE-REPORT-007: 报告详情页 - 统计信息卡片

**描述**: 验证统计信息卡片显示  
**测试步骤**:
1. 进入报告详情页
2. 观察统计信息卡片

**预期结果**: 
- 显示有效笔记数
- 显示已忽略笔记数
- 数字正确显示

---

### TC-FE-REPORT-008: 报告详情页 - 筛选器

**描述**: 验证筛选器功能  
**测试步骤**:
1. 进入报告详情页
2. 选择品牌筛选
3. 选择博主筛选
4. 选择日期范围筛选
5. 点击"刷新"按钮
6. 点击"重置"按钮

**预期结果**: 
- 筛选器正常工作
- 刷新按钮重新加载数据
- 重置按钮清空所有筛选条件

---

### TC-FE-REPORT-009: 报告详情页 - 搜索功能

**描述**: 验证搜索功能  
**测试步骤**:
1. 进入报告详情页
2. 在搜索框输入关键词
3. 观察搜索结果

**预期结果**: 
- 搜索框实时搜索（防抖）
- 支持标题和品牌名称搜索
- 搜索结果正确显示

---

### TC-FE-REPORT-010: 报告详情页 - Tab切换

**描述**: 验证Tab切换功能  
**测试步骤**:
1. 进入报告详情页
2. 切换到"已忽略"tab
3. 切换回"有效笔记"tab

**预期结果**: 
- Tab切换正常
- 不同tab显示不同的笔记列表
- 操作按钮根据tab状态变化

---

### TC-FE-REPORT-011: 报告详情页 - 批量操作

**描述**: 验证批量操作功能  
**测试步骤**:
1. 进入报告详情页
2. 选择多条笔记
3. 观察批量操作栏显示
4. 点击"忽略"按钮
5. 切换到"已忽略"tab
6. 选择笔记，点击"恢复"按钮

**预期结果**: 
- 选中笔记后显示批量操作栏
- 批量忽略功能正常
- 批量恢复功能正常

---

### TC-FE-REPORT-012: 报告详情页 - 笔记表格

**描述**: 验证笔记表格功能  
**测试步骤**:
1. 进入报告详情页
2. 观察表格列
3. 测试排序功能
4. 测试分页功能
5. 测试操作按钮

**预期结果**: 
- 表格列完整显示
- 排序功能正常
- 分页功能正常
- 操作按钮功能正常

---

### TC-FE-REPORT-012: 报告详情页 - 导出Excel

**描述**: 验证达人矩阵导出Excel功能  
**测试步骤**:
1. 进入报告详情页，确保达人矩阵统计已加载
2. 点击“导出Excel”按钮
3. 打开下载的文件

**预期结果**: 
- 成功下载Excel文件
- 文件包含“汇总”与“明细”两张表
- 汇总表字段包含：层级名称、粉丝区间、达人数量、达人占比、平均粉丝数、总互动量、互动量占比、分享量、分享占比、笔记数量、笔记占比、总计行
- 明细表用于复核导出数据，与页面筛选条件一致

---

### TC-FE-REPORT-013: 报告详情页 - 矩阵统计由后端计算

**描述**: 验证达人矩阵统计由后端接口返回，前端不做重复计算  
**测试步骤**:
1. 打开报告详情页，触发加载达人矩阵统计
2. 观察网络请求（或在测试环境拦截/记录）
3. 对比页面展示数据与接口 `GET /api/reports/[id]/blogger-matrix/stats` 返回

**预期结果**: 
- 页面发起统计接口请求
- 页面展示的统计数据与接口返回一致（口径：总互动量=点赞+收藏+评论，不含分享）
- 分享量与分享占比独立显示

---

## 3. 数据库测试用例

### TC-DB-REPORT-001: reports表创建

**描述**: 验证reports表是否正确创建  
**测试步骤**:
1. 执行创建表SQL
2. 检查表结构

**预期结果**: 
- reports表存在
- 所有字段类型正确
- 索引创建成功

---

### TC-DB-REPORT-002: report_notes表创建

**描述**: 验证report_notes表是否正确创建  
**测试步骤**:
1. 执行创建表SQL
2. 检查表结构

**预期结果**: 
- report_notes表存在
- 所有字段类型正确
- 索引创建成功
- 唯一约束创建成功

---

### TC-DB-REPORT-003: 外键约束测试

**描述**: 验证外键约束是否正常工作  
**测试步骤**:
1. 尝试插入不存在的ReportId
2. 尝试插入不存在的NoteId
3. 检查是否报错

**预期结果**: 
- 插入无效外键时应报错

---

### TC-DB-REPORT-004: 唯一约束测试

**描述**: 验证唯一约束是否正常工作  
**测试步骤**:
1. 插入一条report_notes记录
2. 尝试插入相同的(ReportId, NoteId)组合
3. 检查是否报错

**预期结果**: 
- 插入重复组合时应报错

---

### TC-DB-REPORT-005: 级联删除测试

**描述**: 验证级联删除是否正常工作  
**测试步骤**:
1. 创建一条报告，添加一些笔记
2. 删除报告
3. 检查关联的report_notes记录是否被删除

**预期结果**: 
- 删除报告时，关联的report_notes记录自动删除

---

### TC-DB-REPORT-006: RLS策略测试

**描述**: 验证RLS策略是否正确配置  
**测试步骤**:
1. 用户A创建一条报告
2. 用户B尝试查询该报告
3. 用户B尝试修改该报告
4. 检查权限是否正确

**预期结果**: 
- 用户只能访问和操作自己的报告

---

## 4. 集成测试用例

### TC-INT-REPORT-001: 完整创建报告流程

**描述**: 验证完整的创建报告流程  
**测试步骤**:
1. 用户登录
2. 打开创建报告对话框
3. 输入报告名称，选择品牌和时间范围
4. 观察笔记数量计算
5. 创建报告
6. 跳转到报告详情页
7. 验证报告信息显示

**预期结果**: 
- 整个流程顺畅
- 数据正确显示

---

### TC-INT-REPORT-002: 完整追加笔记流程

**描述**: 验证完整的追加笔记流程  
**测试步骤**:
1. 进入报告详情页
2. 记录当前笔记数量
3. 点击"追加笔记"按钮
4. 修改筛选条件
5. 观察增量笔记数量计算
6. 确认追加
7. 验证笔记数量增加

**预期结果**: 
- 整个流程顺畅
- 笔记成功追加

---

### TC-INT-REPORT-003: 完整批量操作流程

**描述**: 验证完整的批量操作流程  
**测试步骤**:
1. 进入报告详情页
2. 选择多条笔记
3. 批量忽略
4. 切换到"已忽略"tab
5. 选择笔记，批量恢复
6. 验证笔记状态变化

**预期结果**: 
- 整个流程顺畅
- 笔记状态正确更新

---

## 5. 性能测试用例

### TC-PERF-REPORT-001: 大量笔记创建报告

**描述**: 验证处理大量笔记时的性能  
**测试步骤**:
1. 选择包含大量笔记的品牌和时间范围
2. 创建报告
3. 测量创建时间

**预期结果**: 
- 创建时间合理（< 30秒，1000条笔记）
- 使用分批处理避免超时

---

### TC-PERF-REPORT-002: 大量笔记查询

**描述**: 验证查询大量笔记时的性能  
**测试步骤**:
1. 创建包含大量笔记的报告
2. 查询笔记列表
3. 测量查询时间

**预期结果**: 
- 查询时间合理（< 2秒，分页查询）
- 使用索引优化查询

---

## 6. 边界测试用例

### TC-BOUNDARY-REPORT-001: 报告名称边界值

**描述**: 验证报告名称边界值  
**测试步骤**:
1. 测试报告名称长度为7字符（应失败）
2. 测试报告名称长度为8字符（应成功）
3. 测试报告名称长度为20字符（应成功）
4. 测试报告名称长度为21字符（应失败）

**预期结果**: 
- 边界值验证正确

---

### TC-BOUNDARY-REPORT-002: 笔记数量为0

**描述**: 验证笔记数量为0时的处理  
**测试步骤**:
1. 选择不包含任何笔记的品牌和时间范围
2. 尝试创建报告

**预期结果**: 
- 按钮禁用
- 显示提示信息

---

### TC-BOUNDARY-REPORT-003: 增量笔记数量为0

**描述**: 验证增量笔记数量为0时的处理  
**测试步骤**:
1. 在已有报告中，选择不包含新笔记的品牌和时间范围
2. 尝试追加笔记

**预期结果**: 
- 按钮禁用
- 显示提示信息

---

## 7. 错误处理测试用例

### TC-ERROR-REPORT-001: 网络错误处理

**描述**: 验证网络错误时的处理  
**测试步骤**:
1. 模拟网络错误
2. 尝试创建报告
3. 观察错误提示

**预期结果**: 
- 显示友好的错误提示
- 提供重试选项

---

### TC-ERROR-REPORT-002: 服务器错误处理

**描述**: 验证服务器错误时的处理  
**测试步骤**:
1. 模拟服务器500错误
2. 尝试创建报告
3. 观察错误提示

**预期结果**: 
- 显示友好的错误提示
- 记录错误日志

---

## 测试数据准备

### 测试品牌数据

- BrandId: "46899", BrandName: "Ralph Lauren拉夫劳伦"
- BrandId: "46900", BrandName: "测试品牌2"

### 测试笔记数据

- 至少准备100条测试笔记
- 包含不同品牌、不同时间范围的笔记
- 包含不同状态的笔记（有效、已忽略）

### 测试报告数据

- 至少创建3条测试报告
- 包含不同数量的笔记
- 包含不同状态的笔记

